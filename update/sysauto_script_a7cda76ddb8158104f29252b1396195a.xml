<?xml version="1.0" encoding="UTF-8"?><record_update table="sysauto_script">
    <sysauto_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <condition/>
        <conditional>false</conditional>
        <name>Testing - Build Test cmdb_ci_server Deletion</name>
        <run_as display_value="Robin Deaville">536d0c591b6a8050f953ff72cd4bcbf1</run_as>
        <run_as_tz/>
        <run_dayofmonth>1</run_dayofmonth>
        <run_dayofweek>1</run_dayofweek>
        <run_period/>
        <run_start>2020-05-28 09:22:15</run_start>
        <run_time>1970-01-01 00:00:00</run_time>
        <run_type>on_demand</run_type>
        <script><![CDATA[main(10);

function main(qty) {
	if (qty < 1) {
		qty = 1;
	}
	
	var cnt = 0;
	while (cnt < qty) {
		cnt = cnt + 1;
		generate(cnt);
	}
}

function generate(num) {
	
	var zeroPaddedNumStr = zeroPad(num,6); // e.g. '000001'
	
	var testTableName = 'x_tekso_twxapp01_test_server';
	var actualTableName = 'x_tekso_twxapp01_test_server';	
	var tableName = 'cmdb_ci_server';
	
	var gdt = new GlideDateTime();	
	
	var gr1 = new GlideRecord('x_tekso_twxapp01_cmdb_deletes');
	gr1.initialize();
	
	var sourceRecordSysID = '';
	var createdBy = gs.getUserName();
	var createdOn = new GlideDateTime();
	var updatedBy = gs.getUserName();
	var updatedOn = new GlideDateTime();	
	var gr2 = new GlideRecord(testTableName); //x_tekso_twxapp01_test_server
	gr2.setLimit(1);
	gr2.query();
	if (gr2.next()) {
		var sysID = gr2.getValue('sys_id') || '';
		sourceRecordSysID = sysID.toString();
		createdBy = gr2.getValue('sys_created_by');
		updatedBy = gr2.getValue('sys_updated_by');	
		createdOn = gr2.getValue('sys_created_on');
		updatedOn = gr2.getValue('sys_updated_on');		
	}
	else {
		sourceRecordSysID = gs.generateGUID();		
	}
	
	//gr1.setValue('source_record_sys_id',current.sys_id);	
	gr1.setValue('source_record_sys_id',sourceRecordSysID);		
	
	gr1.setValue('table_name',tableName); // real table name cmdb_ci_server
	
	//gr1.setValue('record_originally_created_by',current.sys_created_by);
	gr1.setValue('record_originally_created_by',createdBy);

	//gr1.setValue('record_originally_created_on',current.sys_created_on);	
	gr1.setValue('record_originally_created_on',createdOn); 	
	
	//gr1.setValue('record_last_updated_by',current.sys_updated_by);
	gr1.setValue('record_last_updated_by',updatedBy);

	//gr1.setValue('record_last_updated_on',current.sys_updated_on);	
	gr1.setValue('record_last_updated_on',updatedOn);	
	
	//var lastUpdatedBySysID = getUserSysID(current.sys_updated_by);
	var lastUpdatedBySysID = gs.getUserID(updatedBy);	
	gr1.setValue('record_last_updated_by_sys_id',lastUpdatedBySysID);
	
	gr1.setValue('record_deleted_by',gs.getUserName());
	gr1.setValue('record_deleted_by_sys_id',gs.getUserID());
	
	gr1.setValue('record_deleted_on',gdt);	
	
	var correlationID1 = 'correlationID1 [' + zeroPaddedNumStr + ']'; // 512
	correlationID1 = padOutString(correlationID1,512,'!!'); // 512
	//gr1.setValue('correlation_id1',current.correlation_id);
	gr1.setValue('correlation_id1',correlationID1);	

	var discoverySource = 'TekWurx uControl';
	//gr1.setValue('discovery_source1',current.discovery_source);
	gr1.setValue('discovery_source1',discoverySource);
	
	var name = 'name [' + zeroPaddedNumStr + ']';
	name = padOutString(name,255,'!!'); // 255
		
	//gr1.setValue('name',current.name);
	gr1.setValue('name',name);
	
	gr1.setValue('base_table','cmdb_ci');
	
	var allFieldsArr = [];
	
	allFieldsArr.push('asset');
	allFieldsArr.push('asset_tag');
	allFieldsArr.push('assigned');
	allFieldsArr.push('assigned_to');
	allFieldsArr.push('assignment_group');
	allFieldsArr.push('attributes');
	allFieldsArr.push('can_print');
	allFieldsArr.push('category');
	allFieldsArr.push('cd_rom');
	allFieldsArr.push('cd_speed');
	allFieldsArr.push('change_control');
	allFieldsArr.push('chassis_type');
	allFieldsArr.push('checked_in');
	allFieldsArr.push('checked_out');
	allFieldsArr.push('classification');
	allFieldsArr.push('comments');
	allFieldsArr.push('company');
	allFieldsArr.push('correlation_id');
	allFieldsArr.push('cost');
	allFieldsArr.push('cost_cc');
	allFieldsArr.push('cost_center');
	allFieldsArr.push('cpu_core_count');
	allFieldsArr.push('cpu_core_thread');
	allFieldsArr.push('cpu_count');
	allFieldsArr.push('cpu_manufacturer');
	allFieldsArr.push('cpu_name');
	allFieldsArr.push('cpu_speed');
	allFieldsArr.push('cpu_type');
	allFieldsArr.push('default_gateway');
	allFieldsArr.push('delivery_date');
	allFieldsArr.push('department');
	allFieldsArr.push('discovery_source');
	allFieldsArr.push('disk_space');
	allFieldsArr.push('dns_domain');
	allFieldsArr.push('dr_backup');
	allFieldsArr.push('due');
	allFieldsArr.push('due_in');
	allFieldsArr.push('duplicate_of');
	allFieldsArr.push('fault_count');
	allFieldsArr.push('firewall_status');
	allFieldsArr.push('first_discovered');
	allFieldsArr.push('floppy');
	allFieldsArr.push('form_factor');
	allFieldsArr.push('fqdn');
	allFieldsArr.push('gl_account');
	allFieldsArr.push('hardware_status');
	allFieldsArr.push('hardware_substatus');
	allFieldsArr.push('host_name');
	allFieldsArr.push('install_date');
	allFieldsArr.push('install_status');
	allFieldsArr.push('invoice_number');
	allFieldsArr.push('ip_address');
	allFieldsArr.push('justification');
	allFieldsArr.push('last_discovered');
	allFieldsArr.push('lease_id');
	allFieldsArr.push('location');
	allFieldsArr.push('mac_address');
	allFieldsArr.push('maintenance_schedule');
	allFieldsArr.push('managed_by');
	allFieldsArr.push('manufacturer');
	allFieldsArr.push('model_id');
	allFieldsArr.push('model_number');
	allFieldsArr.push('monitor');
	allFieldsArr.push('name');
	allFieldsArr.push('object_id');
	allFieldsArr.push('operational_status');
	allFieldsArr.push('order_date');
	allFieldsArr.push('orginal_value_sys_domain');
	allFieldsArr.push('os');
	allFieldsArr.push('os_address_width');
	allFieldsArr.push('os_domain');
	allFieldsArr.push('os_service_pack');
	allFieldsArr.push('os_version');
	allFieldsArr.push('owned_by');
	allFieldsArr.push('po_number');
	allFieldsArr.push('purchase_date');
	allFieldsArr.push('ram');
	allFieldsArr.push('schedule');
	allFieldsArr.push('serial_number');
	allFieldsArr.push('short_description');
	allFieldsArr.push('skip_sync');
	allFieldsArr.push('start_date');
	allFieldsArr.push('subcategory');
	allFieldsArr.push('support_group');
	allFieldsArr.push('supported_by');
	allFieldsArr.push('sys_class_name');
	allFieldsArr.push('sys_class_path');
	allFieldsArr.push('sys_created_by');
	allFieldsArr.push('sys_created_on');
	allFieldsArr.push('sys_domain');
	allFieldsArr.push('sys_domain_path');
	allFieldsArr.push('sys_id');
	allFieldsArr.push('sys_mod_count');
	allFieldsArr.push('sys_tags');
	allFieldsArr.push('sys_updated_by');
	allFieldsArr.push('sys_updated_on');
	allFieldsArr.push('unverified');
	allFieldsArr.push('used_for');
	allFieldsArr.push('vendor');
	allFieldsArr.push('virtual');
	allFieldsArr.push('warranty_expiration');

	var allFields = allFieldsArr.join(',');
	gr1.setValue('all_fields',allFields);

	gr1.setValue('no_of_fields',allFieldsArr.length);	
	gr1.setValue('total_length_of_all_fields_list',allFields.length);		
	gr1.setValue('test_data',true); // TESTING

	//gr1.setValue('test_table_name',tblName.toString()); // getTableName() returns an object - need to convert to String
	gr1.setValue('test_table_name',testTableName); //x_tekso_twxapp01_test_server
	
	//gr1.setValue('actual_table_name',tblName.toString()); // getTableName() returns an object - need to convert to String
	gr1.setValue('actual_table_name',actualTableName); //x_tekso_twxapp01_test_server
	
	gr1.setValue('inserted_by_script','Testing - Build Test cmdb_ci_server Deletion');
	gr1.insert();

}


function padOutString(existingText,maxSize,tail) {
	var rtnStr = '';
	var str = '';
	var ln = 0;
	var ln2 = 0;

	str = existingText + ' ' + tail;		

	ln = str.length;
	if (ln >= maxSize) {
		// String + tail is biiger than max size 
		// so do a left() to get back the maxsize
		rtnStr = str.substring(0,maxSize);
	}		
	else {
		ln2 = maxSize - ln;
		str = this.generateString(ln2);
		rtnStr = existingText + ' ' + str + tail;			
	}
	return rtnStr;
}

function generateString(size) {
	var rtnStr = '';

	var template = 'abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789';

	var str = '';
	var ln = 0;
	str = template;
	ln = str.length;
	while (ln < size) {
		str = str + template;
		ln = str.length;
	}

	rtnStr = str.substring(0, size);

	return rtnStr;
}
		
function zeroPad(number,maxSize) {
	var rtnStr = '';
	var maxSize2 = maxSize * -1;
	var template = '000000000000000';
	var numStr = number.toString();
	var str = template + numStr;
	rtnStr = str.substr(maxSize2);
	return rtnStr;
}
]]></script>
        <sys_class_name>sysauto_script</sys_class_name>
        <sys_created_by>robin</sys_created_by>
        <sys_created_on>2020-05-28 09:31:28</sys_created_on>
        <sys_id>a7cda76ddb8158104f29252b1396195a</sys_id>
        <sys_mod_count>5</sys_mod_count>
        <sys_name>Testing - Build Test cmdb_ci_server Deletion</sys_name>
        <sys_package display_value="Application 1" source="x_tekso_twxapp01">993be4b2db62085035a38a72399619a7</sys_package>
        <sys_policy/>
        <sys_scope display_value="Application 1">993be4b2db62085035a38a72399619a7</sys_scope>
        <sys_update_name>sysauto_script_a7cda76ddb8158104f29252b1396195a</sys_update_name>
        <sys_updated_by>robin</sys_updated_by>
        <sys_updated_on>2020-05-28 14:28:05</sys_updated_on>
        <upgrade_safe>false</upgrade_safe>
    </sysauto_script>
</record_update>
