<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_tekso_twxapp01.HouseKeeping</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>HouseKeeping</name>
        <script><![CDATA[/* Example calling:
var tbl = 'x_tekso_twxapp01_cmdb_deletes';
new x_tekso_twxapp01.HouseKeeping().deleteRecordsCreatedEarlierThanNDaysAgo(tbl,5);
*/

var HouseKeeping = Class.create();
HouseKeeping.prototype = {
    initialize: function() {
    },
	// But retain last N records
	// Get the most recent N records - store the sys_id's in an array
	// Only delete if not in this list
	deleteRecordsCreatedEarlierThanNDaysAgo: function(tbl,daysAgo) {

		var tbl2 = tbl.toString();
		if (tbl2.length > 0 && daysAgo > -1) {
			var gr1 = new GlideRecordSecure(tbl);
			gr1.addQuery('sys_created_on','<',gs.daysAgo(daysAgo));
			gr1.orderBy('sys_created_on'); //Ascending Order
			gr1.query();
			var cnt = 0;
			var firstSysID = '';
			var firstSysID2 = '';
			var firstNum = '';
			var firstDT = new GlideDateTime();
			var lastSysID = '';
			var lastSysID2 = '';
			var lastNum = '';
			var lastDT = new GlideDateTime();
			while(gr1.next()) {
				if (cnt == 0) {
					firstNum = gr1.getValue('number');
					firstSysID = gr1.getValue('sys_id');
					firstSysID2 = firstSysID.toString();
					firstDT = gr1.getValue('sys_created_on');
				}
				lastNum = gr1.getValue('number');
				lastSysID = gr1.getValue('sys_id');
				lastSysID2 = lastSysID.toString();
				lastDT = gr1.getValue('sys_created_on');
				cnt = cnt + 1;
				gr1.setWorkflow(false);
				gr1.deleteRecord();
			}

			if (cnt > 0) {
				var msg = 'Deleted ' + cnt.toString() + ' records from table: ' + tbl; 
				msg = msg + ' created before: ' + gs.daysAgo(daysAgo) + ' ranging from: ' + firstNum; 
				msg = msg + ' created at ' + firstDT + ' to: ' + lastNum + ' created at ' + lastDT;
				gs.info(msg);
			}
		}
	},
    type: 'HouseKeeping'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>robin</sys_created_by>
        <sys_created_on>2020-06-08 09:17:56</sys_created_on>
        <sys_id>ddf4d099db9d50104f29252b13961969</sys_id>
        <sys_mod_count>4</sys_mod_count>
        <sys_name>HouseKeeping</sys_name>
        <sys_package display_value="Application 1" source="x_tekso_twxapp01">993be4b2db62085035a38a72399619a7</sys_package>
        <sys_policy>protected</sys_policy>
        <sys_scope display_value="Application 1">993be4b2db62085035a38a72399619a7</sys_scope>
        <sys_update_name>sys_script_include_ddf4d099db9d50104f29252b13961969</sys_update_name>
        <sys_updated_by>robin</sys_updated_by>
        <sys_updated_on>2020-06-24 11:48:25</sys_updated_on>
    </sys_script_include>
</record_update>
