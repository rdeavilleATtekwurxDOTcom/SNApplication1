<?xml version="1.0" encoding="UTF-8"?><record_update table="sysauto_script">
    <sysauto_script action="INSERT_OR_UPDATE">
        <active>false</active>
        <condition/>
        <conditional>false</conditional>
        <name>OBSOLETE - Testing - Build Test cmdb_ci Update cmdb_ci_appl</name>
        <run_as display_value="Robin Deaville">536d0c591b6a8050f953ff72cd4bcbf1</run_as>
        <run_as_tz/>
        <run_dayofmonth>1</run_dayofmonth>
        <run_dayofweek>1</run_dayofweek>
        <run_period/>
        <run_start>2020-05-28 10:14:17</run_start>
        <run_time>1970-01-01 00:00:00</run_time>
        <run_type>on_demand</run_type>
        <script><![CDATA[main(10);

function main(qty) {
	if (qty < 1) {
		qty = 1;
	}
	
	var cnt = 0;
	while (cnt < qty) {
		cnt = cnt + 1;
		generate(cnt);
	}
}

function generate(num) {

	// Exclude sys_updated_on, sys_updated_by and sys_mod_count
	
	var zeroPaddedNumStr = zeroPad(num,6); // e.g. '000001'

	var gdt = new GlideDateTime();	
	
	var tableName = 'cmdb_ci_appl';
	var testTableName = 'x_tekso_twxapp01_test_application';
	var actualTableName = 'x_tekso_twxapp01_test_application';
	
	var gr1 = new GlideRecord('x_tekso_twxapp01_cmdb_updates');
	gr1.initialize();
	
	var sourceRecordSysID = '';
	var createdBy = gs.getUserName();
	var createdOn = new GlideDateTime();
	var updatedBy = gs.getUserName();
	var updatedOn = new GlideDateTime();	
	var gr2 = new GlideRecord(testTableName); // x_tekso_twxapp01_test_application
	gr2.setLimit(1);
	gr2.query();
	if (gr2.next()) {
		var sysID = gr2.getValue('sys_id') || '';
		sourceRecordSysID = sysID.toString();
		createdBy = gr2.getValue('sys_created_by');
		updatedBy = gr2.getValue('sys_updated_by');	
		createdOn = gr2.getValue('sys_created_on');
		updatedOn = gr2.getValue('sys_updated_on');			
	}
	else {
		sourceRecordSysID = gs.generateGUID();		
	}
	
	//gr1.setValue('source_record_sys_id',current.sys_id);
	gr1.setValue('source_record_sys_id',sourceRecordSysID);
	
	gr1.setValue('table_name',tableName); // real table name cmdb_ci_appl
	
	//gr1.setValue('record_originally_created_by',current.sys_created_by);
	gr1.setValue('record_originally_created_by',createdBy);

	//gr1.setValue('record_originally_created_on',current.sys_created_on);	
	gr1.setValue('record_originally_created_on',createdOn); 	
	
	//gr1.setValue('record_updated_by',current.sys_updated_by);
	gr1.setValue('record_updated_by',updatedBy);

	var updatedBySysID = gs.getUserID(updatedBy);	
	gr1.setValue('record_updated_by_sys_id',updatedBySysID);
	
	//gr1.setValue('record_updated_on',current.sys_updated_on);	
	gr1.setValue('record_updated_on',gdt);	

	gr1.setValue('base_table','cmdb_ci');	

	var fieldsChangedArr = [];

	fieldsChangedArr.push('asset');
	fieldsChangedArr.push('asset_tag');
	fieldsChangedArr.push('assigned');
	fieldsChangedArr.push('assigned_to');
	fieldsChangedArr.push('assignment_group');
	fieldsChangedArr.push('attributes');
	fieldsChangedArr.push('can_print');
	fieldsChangedArr.push('category');
	fieldsChangedArr.push('change_control');
	fieldsChangedArr.push('checked_in');
	fieldsChangedArr.push('checked_out');
	fieldsChangedArr.push('cl_port');
	fieldsChangedArr.push('comments');
	fieldsChangedArr.push('company');
	fieldsChangedArr.push('config_directory');
	fieldsChangedArr.push('config_file');
	fieldsChangedArr.push('correlation_id');
	fieldsChangedArr.push('cost');
	fieldsChangedArr.push('cost_cc');
	fieldsChangedArr.push('cost_center');
	fieldsChangedArr.push('delivery_date');
	fieldsChangedArr.push('department');
	fieldsChangedArr.push('discovery_source');
	fieldsChangedArr.push('dns_domain');
	fieldsChangedArr.push('due');
	fieldsChangedArr.push('due_in');
	fieldsChangedArr.push('duplicate_of');
	fieldsChangedArr.push('edition');
	fieldsChangedArr.push('fault_count');
	fieldsChangedArr.push('first_discovered');
	fieldsChangedArr.push('fqdn');
	fieldsChangedArr.push('gl_account');
	fieldsChangedArr.push('install_date');
	fieldsChangedArr.push('install_directory');
	fieldsChangedArr.push('install_status');
	fieldsChangedArr.push('invoice_number');
	fieldsChangedArr.push('ip_address');
	fieldsChangedArr.push('is_clustered');
	fieldsChangedArr.push('justification');
	fieldsChangedArr.push('last_discovered');
	fieldsChangedArr.push('lease_id');
	fieldsChangedArr.push('location');
	fieldsChangedArr.push('mac_address');
	fieldsChangedArr.push('maintenance_schedule');
	fieldsChangedArr.push('managed_by');
	fieldsChangedArr.push('manufacturer');
	fieldsChangedArr.push('model_id');
	fieldsChangedArr.push('model_number');
	fieldsChangedArr.push('monitor');
	fieldsChangedArr.push('name');
	fieldsChangedArr.push('operational_status');
	fieldsChangedArr.push('order_date');
	fieldsChangedArr.push('orginal_value_sys_domain');
	fieldsChangedArr.push('owned_by');
	fieldsChangedArr.push('pid');
	fieldsChangedArr.push('po_number');
	fieldsChangedArr.push('purchase_date');
	fieldsChangedArr.push('rp_command_hash');
	fieldsChangedArr.push('rp_key_parameters_hash');
	fieldsChangedArr.push('running_process_command');
	fieldsChangedArr.push('running_process_key_parameters');
	fieldsChangedArr.push('schedule');
	fieldsChangedArr.push('serial_number');
	fieldsChangedArr.push('short_description');
	fieldsChangedArr.push('skip_sync');
	fieldsChangedArr.push('start_date');
	fieldsChangedArr.push('subcategory');
	fieldsChangedArr.push('support_group');
	fieldsChangedArr.push('supported_by');
	//Exclude the sys_ fields
	//fieldsChangedArr.push('sys_class_name');
	//fieldsChangedArr.push('sys_class_path');
	//fieldsChangedArr.push('sys_created_by');
	//fieldsChangedArr.push('sys_created_on');
	//fieldsChangedArr.push('sys_domain');
	//fieldsChangedArr.push('sys_domain_path');
	//fieldsChangedArr.push('sys_id');
	//fieldsChangedArr.push('sys_mod_count');
	//fieldsChangedArr.push('sys_tags');
	//fieldsChangedArr.push('sys_updated_by');
	//fieldsChangedArr.push('sys_updated_on');
	fieldsChangedArr.push('tcp_port');
	fieldsChangedArr.push('unverified');
	fieldsChangedArr.push('used_for');
	fieldsChangedArr.push('vendor');
	fieldsChangedArr.push('version');
	fieldsChangedArr.push('warranty_expiration');

    var fieldsChanged = fieldsChangedArr.join(',');	
	gr1.setValue('fields_changed',fieldsChanged);
	gr1.setValue('number_of_fields_changed',fieldsChangedArr.length);	
	gr1.setValue('total_length_of_fields_changed_list',fieldsChanged.length);		
	
	var name = 'name [' + zeroPaddedNumStr + ']';
	name = padOutString(name,255,'!!'); // 255
		
	//gr1.setValue('name',current.name);
	gr1.setValue('name',name);
		
	var allFieldsArr = [];

	allFieldsArr.push('asset');
	allFieldsArr.push('asset_tag');
	allFieldsArr.push('assigned');
	allFieldsArr.push('assigned_to');
	allFieldsArr.push('assignment_group');
	allFieldsArr.push('attributes');
	allFieldsArr.push('can_print');
	allFieldsArr.push('category');
	allFieldsArr.push('change_control');
	allFieldsArr.push('checked_in');
	allFieldsArr.push('checked_out');
	allFieldsArr.push('cl_port');
	allFieldsArr.push('comments');
	allFieldsArr.push('company');
	allFieldsArr.push('config_directory');
	allFieldsArr.push('config_file');
	allFieldsArr.push('correlation_id');
	allFieldsArr.push('cost');
	allFieldsArr.push('cost_cc');
	allFieldsArr.push('cost_center');
	allFieldsArr.push('delivery_date');
	allFieldsArr.push('department');
	allFieldsArr.push('discovery_source');
	allFieldsArr.push('dns_domain');
	allFieldsArr.push('due');
	allFieldsArr.push('due_in');
	allFieldsArr.push('duplicate_of');
	allFieldsArr.push('edition');
	allFieldsArr.push('fault_count');
	allFieldsArr.push('first_discovered');
	allFieldsArr.push('fqdn');
	allFieldsArr.push('gl_account');
	allFieldsArr.push('install_date');
	allFieldsArr.push('install_directory');
	allFieldsArr.push('install_status');
	allFieldsArr.push('invoice_number');
	allFieldsArr.push('ip_address');
	allFieldsArr.push('is_clustered');
	allFieldsArr.push('justification');
	allFieldsArr.push('last_discovered');
	allFieldsArr.push('lease_id');
	allFieldsArr.push('location');
	allFieldsArr.push('mac_address');
	allFieldsArr.push('maintenance_schedule');
	allFieldsArr.push('managed_by');
	allFieldsArr.push('manufacturer');
	allFieldsArr.push('model_id');
	allFieldsArr.push('model_number');
	allFieldsArr.push('monitor');
	allFieldsArr.push('name');
	allFieldsArr.push('operational_status');
	allFieldsArr.push('order_date');
	allFieldsArr.push('orginal_value_sys_domain');
	allFieldsArr.push('owned_by');
	allFieldsArr.push('pid');
	allFieldsArr.push('po_number');
	allFieldsArr.push('purchase_date');
	allFieldsArr.push('rp_command_hash');
	allFieldsArr.push('rp_key_parameters_hash');
	allFieldsArr.push('running_process_command');
	allFieldsArr.push('running_process_key_parameters');
	allFieldsArr.push('schedule');
	allFieldsArr.push('serial_number');
	allFieldsArr.push('short_description');
	allFieldsArr.push('skip_sync');
	allFieldsArr.push('start_date');
	allFieldsArr.push('subcategory');
	allFieldsArr.push('support_group');
	allFieldsArr.push('supported_by');
	allFieldsArr.push('sys_class_name');
	allFieldsArr.push('sys_class_path');
	allFieldsArr.push('sys_created_by');
	allFieldsArr.push('sys_created_on');
	allFieldsArr.push('sys_domain');
	allFieldsArr.push('sys_domain_path');
	allFieldsArr.push('sys_id');
	allFieldsArr.push('sys_mod_count');
	allFieldsArr.push('sys_tags');
	allFieldsArr.push('sys_updated_by');
	allFieldsArr.push('sys_updated_on');
	allFieldsArr.push('tcp_port');
	allFieldsArr.push('unverified');
	allFieldsArr.push('used_for');
	allFieldsArr.push('vendor');
	allFieldsArr.push('version');
	allFieldsArr.push('warranty_expiration');
	
    var allFields = allFieldsArr.join(',');
	gr1.setValue('all_fields',allFields);

	gr1.setValue('no_of_fields',allFieldsArr.length);	
	
	gr1.setValue('total_length_of_all_fields_list',allFields.length);	

	gr1.setValue('test_table_name',testTableName); //x_tekso_twxapp01_test_application
	
	gr1.setValue('test_data',true); // TESTING	
	
	gr1.setValue('inserted_by_script','Testing - Build Test cmdb_ci Update cmdb_ci_appl');		
	gr1.insert();
}

function padOutString(existingText,maxSize,tail) {
	var rtnStr = '';
	var str = '';
	var ln = 0;
	var ln2 = 0;

	str = existingText + ' ' + tail;		

	ln = str.length;
	if (ln >= maxSize) {
		// String + tail is biiger than max size 
		// so do a left() to get back the maxsize
		rtnStr = str.substring(0,maxSize);
	}		
	else {
		ln2 = maxSize - ln;
		str = this.generateString(ln2);
		rtnStr = existingText + ' ' + str + tail;			
	}
	return rtnStr;
}

function generateString(size) {
	var rtnStr = '';

	var template = 'abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789';

	var str = '';
	var ln = 0;
	str = template;
	ln = str.length;
	while (ln < size) {
		str = str + template;
		ln = str.length;
	}

	rtnStr = str.substring(0, size);

	return rtnStr;
}
		
function zeroPad(number,maxSize) {
	var rtnStr = '';
	var maxSize2 = maxSize * -1;
	var template = '000000000000000';
	var numStr = number.toString();
	var str = template + numStr;
	rtnStr = str.substr(maxSize2);
	return rtnStr;
}
]]></script>
        <sys_class_name>sysauto_script</sys_class_name>
        <sys_created_by>robin</sys_created_by>
        <sys_created_on>2020-05-28 10:16:36</sys_created_on>
        <sys_id>adb937e5dbc158104f29252b139619aa</sys_id>
        <sys_mod_count>7</sys_mod_count>
        <sys_name>OBSOLETE - Testing - Build Test cmdb_ci Update cmdb_ci_appl</sys_name>
        <sys_package display_value="Application 1" source="x_tekso_twxapp01">993be4b2db62085035a38a72399619a7</sys_package>
        <sys_policy/>
        <sys_scope display_value="Application 1">993be4b2db62085035a38a72399619a7</sys_scope>
        <sys_update_name>sysauto_script_adb937e5dbc158104f29252b139619aa</sys_update_name>
        <sys_updated_by>robin</sys_updated_by>
        <sys_updated_on>2020-06-17 17:24:44</sys_updated_on>
        <upgrade_safe>false</upgrade_safe>
    </sysauto_script>
</record_update>
